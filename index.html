<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Papynom√®tre ‚Äì Joyeux anniversaire Papy üéâ</title>
  <style>
    :root{
      --bg:#f5f5f2;
      --ink:#222;
      --muted:#6b7280;
      --brand:#2563eb;
      --accent:#22c55e;
      --card:#ffffff;
      --border:#e5e7eb;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg);
      color:var(--ink);
      line-height:1.5;
    }

    header{
      position:sticky; top:0; z-index:50;
      background:rgba(255,255,255,0.8);
      backdrop-filter: saturate(1.2) blur(6px);
      border-bottom:1px solid var(--border);
    }
    .wrap{max-width:1100px; margin:0 auto; padding:14px 16px;}
    .title{display:flex; align-items:center; gap:12px;}
    .badge{font-size:12px; color:var(--muted)}

    main{max-width:1100px; margin:24px auto; padding:0 16px; display:grid; gap:16px; grid-template-columns: 1.3fr 1fr;}
    @media (max-width: 930px){ main{grid-template-columns:1fr} }

    .card{background:var(--card); border:1px solid var(--border); border-radius:16px; padding:16px; box-shadow: 0 6px 18px rgba(0,0,0,.05)}
    .card h2{margin:0 0 8px}
    .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    .muted{color:var(--muted)}

    .tool-btn{
      --btn-bg:#ffd166; --btn-bg-2:#fca311; --btn-ink:#1f2937;
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 14px; border-radius:999px; border:1px solid #00000010; cursor:pointer; user-select:none;
      background: linear-gradient(180deg,var(--btn-bg),var(--btn-bg-2));
      box-shadow: 0 8px 0 #b45309, 0 12px 18px rgba(0,0,0,.15);
      transform: translateY(0);
      transition:.15s ease-in-out;
      font-weight:700; letter-spacing:.2px;
    }
    .tool-btn:active{ transform: translateY(3px); box-shadow: 0 5px 0 #b45309, 0 10px 16px rgba(0,0,0,.12); }
    .tool-btn svg{ width:24px; height:24px }

    .duck-pop{ position:fixed; right:70px; bottom:500px; z-index:100; pointer-events:none; opacity:0; transform: translateY(8px) scale(.96); transition:.25s ease; }
    .duck-pop.show{ opacity:1; transform: translateY(0) scale(1); }
    .duck{ font-size:150px; filter: drop-shadow(0 8px 16px rgba(0,0,0,.25)); animation: bob 1.8s ease-in-out infinite; }
    @keyframes bob{ 50%{ transform: translateY(-6px) } }

    .gauge{ background:#eef2ff; border:1px solid var(--border); height:16px; border-radius:999px; overflow:hidden; position:relative }
    .gauge > .bar{ height:100%; width:0%; background: linear-gradient(90deg,#34d399,#22c55e); transition: width .6s ease; }
    .gauge .tick{ position:absolute; top:0; bottom:0; width:2px; background:#00000010 }

    button, .btn{ background:#111827; color:#fff; border:none; border-radius:12px; padding:10px 12px; cursor:pointer; font-weight:600 }
    button.ghost{ background:#ffffff; color:#111827; border:1px solid var(--border) }
    a.btn{ text-decoration:none; display:inline-block }

    #catVideoContainer iframe{ width:100%; height:260px; border:0; border-radius:12px }

    .quiz-q{ font-weight:700; margin-bottom:8px }
    .quiz-choices{ display:grid; gap:8px }
    .quiz-choices button{ text-align:left }

    .game-wrap{ display:grid; grid-template-columns: auto 1fr; gap:16px; align-items:start }
    .grid{
      display:grid;
      grid-template-columns: repeat(5, 56px);
      grid-auto-rows:56px;
      gap:6px;
      background:#f1f5f9;
      padding:10px;
      border-radius:16px;
      border:1px solid var(--border);

      /* corrections */
      width:fit-content;
      max-width:100%;
      margin-right:auto;
    }
    .cell{ display:grid; place-items:center; font-weight:800; font-size:24px; border-radius:12px; background:#ffffff; border:1px solid var(--border); box-shadow: inset 0 -2px #00000010; user-select:none }
    .cell.empty{ background:#f8fafc; color:#cbd5e1; border-style:dashed }
    .next{ background:#fff; border:1px solid var(--border); border-radius:16px; padding:12px; }
    .queue{ display:flex; gap:8px }
    .queue .tile{ width:40px; height:40px; display:grid; place-items:center; font-weight:900; border-radius:10px; border:1px solid var(--border); background:#fff }
    .score{ font-size: 2rem; font-weight:700 }
    .flash{ animation: flash 1.7s ease } @keyframes flash{ 50%{ background:#ff5a5a } }
    .flashcorrect{ animation: flashcorrect 2s ease } @keyframes flashcorrect{ 50%{ background:#a1f69b } 
  </style>
</head>
<body>
  <header>
    <div class="wrap title">
      <h1 style="margin:0; font-size:22px"> </h1>
      <span class="badge"></span>
      <div style="margin-left:auto" class="row">
        <button class="tool-btn" id="duckBtn">
          <span>Joyeux anniversaire !</span>
        </button>
      </div>
    </div>
  </header>

  <div class="duck-pop" id="duckPop" aria-hidden="true">
    <div class="duck" aria-label="Canard">ü¶Ü</div>
    <audio id="coinAudio">
      <source src="duck-quacking-37392.mp3" type="audio/mpeg"> 
    </audio>
  </div>

  <main>
  

    <section class="card" style="grid-column: 1 / -1">
      <div class="row" style="justify-content:space-between; align-items:center">
        <h2 style="margin:0"> Mini-jeu sp√©cialement cr√©√© pour toi (5√ó5)</h2>
        <audio id="jazz" controls loop style="height:34px">
          <source src="jazz.mp3" type="audio/mpeg">
        </audio>
      </div>

      <div class="game-wrap">
        <div class="next">
          <div class="muted">Prochaines lettres</div>
          <div class="queue" id="queue"></div>
          <p class="score">Score : <span id="score">0</span></p>
          <div class="row" style="margin-top:6px">
            <button id="newGame" class="ghost">Nouvelle partie</button>
          </div>
          <div class="row" style="margin-top:10px">
            <span class="muted" id="lexInfo">Lexique : int√©gr√© (petit). Le fichier <code>mots.txt</code> est charg√© automatiquement.</span>
          </div>
        </div>
        <div>
          <div class="grid" id="grid" aria-label="Grille 5 par 5 (clique une colonne pour faire tomber la lettre)"></div>
          <p class="muted"> Le but du jeu est de faire des mots, les lettres arrivent par la gauche. Il suffit de cliquer sur une colonne pour qu'une lettre tombe dedans ! Bisous</p>
        </div>
      </div>
    </section>
  </main>

  <footer class="wrap" style="margin-bottom:40px; color:#6b7280">
    Fait en Ao√ªt 2
  </footer>

  <script>
    const $ = (sel, root=document) => root.querySelector(sel);
    const stripAccents = (s) => s.normalize('NFD').replace(/[\u0300-\u036f]/g, '');

    const duckBtn = document.getElementById('duckBtn');
    const duckPop = document.getElementById('duckPop');
    const coinAudio = document.getElementById('coinAudio');
    duckBtn.addEventListener('click', ()=>{
      duckPop.classList.add('show');
      try { coinAudio.currentTime = 0; coinAudio.play(); } catch(e){}
      setTimeout(()=>{ duckPop.classList.remove('show'); try{ coinAudio.pause(); }catch(e){} }, 2500);
    });

    const gaugeBar = document.getElementById('gaugeBar');
    const timerLabel = document.getElementById('timerLabel');
    const FILL_SECONDS = 30 * 60;
    const start = Date.now();
    setInterval(()=>{
      const elapsed = Math.floor((Date.now()-start)/1000);
      const pct = Math.min(100, (elapsed / FILL_SECONDS) * 100);
      if(gaugeBar) gaugeBar.style.width = pct.toFixed(2) + '%';
      if(timerLabel) timerLabel.textContent = elapsed + 's pass√©es';
    }, 500);

    // --- Mini-jeu ---
    const gridEl = document.getElementById('grid');
    const queueEl = document.getElementById('queue');
    const scoreEl = document.getElementById('score');
    const newGameBtn = document.getElementById('newGame');
    const lexInfo = document.getElementById('lexInfo');

    const ROWS = 5, COLS = 5;
    let grid = [];
    let score = 0;

    const LETTERS = [
      ['A',9],['B',2],['C',2],['D',3],['E',15],['F',2],['G',2],['H',2],
      ['I',8],['J',1],['K',1],['L',5],['M',3],['N',6],['O',6],['P',2],
      ['Q',1],['R',6],['S',6],['T',6],['U',6],['V',2],['W',1],['X',1],['Y',1],['Z',1]
    ];
    const bag = [];
    LETTERS.forEach(([ch, n])=>{ for(let i=0;i<n;i++) bag.push(ch); });
    function randomLetter(){ return bag[Math.floor(Math.random()*bag.length)]; }

    let LEXICON = new Set([
      'LE','LA','EU','ME','MES','SES','SI','SON','SA','LES','UN','UNE','ET','EST','SUR',
      'TES','SEL','LOT','ROI','LIT','MER','RUE','NE','RE','SU','FEU','LIEU','TARTE','CAFE',
      'CHAT','TORTUE','PARIS','LION','SAS','SALON','LUNE','SOLEIL','MERE','PERE','TETE'
    ]);
    const updateLexInfo = () => { lexInfo.textContent = `Lexique : ${LEXICON.size} mot(s) charg√©(s).`; };
    updateLexInfo();

    function setLexiconFromText(text){
      const lines = text.split(/\r?\n/);
      const words = [];
      for(const raw of lines){
        let up = stripAccents(String(raw).trim().toUpperCase());
        up = up.replace(/[^A-Z]/g,'');
        if(up.length>=2 && up.length<=12) words.push(up);
      }
      LEXICON = new Set(words);
      updateLexInfo();
    }

    fetch('mots.txt')
      .then(r => r.ok ? r.text() : Promise.reject())
      .then(setLexiconFromText)
      .catch(() => {});

    // File d‚Äôattente
    let queue = [];
    function refillQueue(){ while(queue.length<5) queue.push(randomLetter()); drawQueue(); }
    function drawQueue(){
      queueEl.innerHTML = '';
      queue.forEach((ch, i)=>{
        const d = document.createElement('div'); d.className='tile'; d.textContent = ch; if(i===0) d.style.outline='2px solid #94a3b8';
        queueEl.appendChild(d);
      });
    }

    function newGame(){
      grid = Array.from({length:ROWS}, ()=> Array.from({length:COLS}, ()=> null));
      score = 0; scoreEl.textContent = '0';
      queue = []; refillQueue();
      drawGrid();
    }

    function drawGrid(){
      gridEl.innerHTML = '';
      for(let r=0;r<ROWS;r++){
        for(let c=0;c<COLS;c++){
          const cell = document.createElement('div');
          cell.className = 'cell' + (grid[r][c] ? '' : ' empty');
          cell.textContent = grid[r][c] || '¬∑';
          cell.dataset.row = String(r);
          cell.dataset.col = String(c);
          gridEl.appendChild(cell);
        }
      }
    }

    gridEl.addEventListener('click', (e)=>{
      const cell = e.target.closest('.cell');
      if(!cell) return;
      const col = Number(cell.dataset.col);
      dropInColumn(col);
    });

    function lowestEmptyRow(col){
      for(let r=ROWS-1; r>=0; r--){ if(!grid[r][col]) return r; }
      return -1;
    }

    function dropInColumn(col){
      const r = lowestEmptyRow(col);
      if(r===-1){
        for(let rr=0; rr<ROWS; rr++){
          const idx = rr*COLS + col;
          const cell = gridEl.children[idx];
          if(cell){ cell.classList.remove('flash'); void cell.offsetWidth; cell.classList.add('flash'); }
        }
        return;
      }
      const letter = queue.shift(); refillQueue();
      grid[r][col] = letter;
      drawGrid();
      resolveWords();
    }

    function resolveWords(){
      const toClear = new Set();

      // lignes
      for(let r=0;r<ROWS;r++){
        let run = ''; let start=0;
        for(let c=0;c<=COLS;c++){
          const ch = (c<COLS)? grid[r][c] : null;
          if(ch){ if(run==='') start=c; run+=ch; }
          if(!ch || c===COLS){
            if(run.length>=2){
              for(let i=0;i<run.length;i++){
                for(let j=i+2;j<=run.length;j++){
                  const sub = run.slice(i,j);
                  if(LEXICON.has(sub)){
                    for(let k=start+i; k<start+j; k++){ toClear.add(r+','+k); }
                    score += sub.length * sub.length;
                  }
                }
              }
            }
            run='';
          }
        }
      }

      // colonnes
      for(let c=0;c<COLS;c++){
        let run=''; let start=0;
        for(let r=0;r<=ROWS;r++){
          const ch = (r<ROWS)? grid[r][c] : null;
          if(ch){ if(run==='') start=r; run+=ch; }
          if(!ch || r===ROWS){
            if(run.length>=2){
              for(let i=0;i<run.length;i++){
                for(let j=i+2;j<=run.length;j++){
                  const sub = run.slice(i,j);
                  if(LEXICON.has(sub)){
                    for(let k=start+i; k<start+j; k++){ toClear.add(k+','+c); }
                    score += sub.length;
                  }
                }
              }
            }
            run='';
          }
        }
      }

      if(toClear.size>0){
        toClear.forEach(key=>{
          const [r,c]=key.split(',').map(Number);
          const idx = r*COLS + c;
          const cell = gridEl.children[idx];
          if(cell){ cell.classList.add("flashcorrect"); }
        });

        setTimeout(()=>{
          toClear.forEach(key=>{
            const [r,c]=key.split(',').map(Number);
            grid[r][c]=null;
          });

          for(let c=0;c<COLS;c++){
            let write = ROWS-1;
            for(let r=ROWS-1;r>=0;r--){
              if(grid[r][c]){
                grid[write][c]=grid[r][c];
                if(write!==r) grid[r][c]=null;
                write--;
              }
            }
          }

          scoreEl.textContent = String(score);
          drawGrid();
          setTimeout(resolveWords, 60);
        }, 2000);
      }
    }

    newGameBtn.addEventListener('click', newGame);
    newGame();
  </script>
</body>
</html>
